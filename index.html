<!DOCTYPE html>
<html>
<head>
    <title>Patrones de distribución óptima de dispositivos en plantaciones</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
    <header>
        <h1>Patrones de distribución óptima de dispositivos en plantaciones</h1>
        <p>Más información en <a href="https://github.com/acarril/device-patterns" target="_blank">https://github.com/acarril/device-patterns</a></p>
    </header>

    <main>
        <form id="api-form">
            <label for="p">Plantas:</label>
            <input type="number" id="p" name="p" placeholder="Número de plantas" required>
            <label for="d_min">Densidad:</label>
            <input type="number" id="d_min" name="d_min" placeholder="Densidad mínima" required>
            <input type="submit" value="Calcular">
        </form>
        <section id="result">
            <!-- Results will be populated here -->
        </section>
    </main>

    <script>
        document.getElementById('api-form').addEventListener('submit', function(event) {
            event.preventDefault(); // prevent the form from being submitted normally
            const p = document.getElementById('p').value;
            const d_min = document.getElementById('d_min').value;
    
            fetch('https://jix6oc21j7.execute-api.us-east-1.amazonaws.com/api/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    p: p,
                    d_min: d_min
                })
            })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = '<h2>Soluciones</h2>';

                ['min_densidad', 'min_hileras'].forEach(key => {
                    const item = data[key];
                    let title = '';
                    if (key === 'min_densidad') {
                        title = 'Minimizando densidad';
                        desc = 'foo';
                    } else if (key === 'min_hileras') {
                        title = 'Minimizando hileras';
                        desc = 'bar';
                    }
                    resultDiv.innerHTML += `
                        <h3>${title}</h3>
                        <p><b>Densidad:</b> ${item.densidad}</p>
                        <p><b>Patrones:</b> </p>
                    `;
                    item.patrones.forEach(pattern => {
                        const [filled, total] = pattern.split('/').map(Number);
                        let dotString = '';
                        for (let j = 0; j < 3; j++) { // Repeat pattern 3 times
                            dotString += '<div class="row">';
                            for (let i = 0; i < total; i++) {
                                if (i < filled) {
                                    dotString += '<span class="dot filled"></span>';
                                } else {
                                    dotString += '<span class="dot"></span>';
                                }
                            }
                            dotString += '</div>';
                        }
                        resultDiv.innerHTML += `
                            <div class="pattern-container">
                                <p>${pattern} </p>
                                <div class="pattern">${dotString}</div><p style="color: LightGray">...</p>
                            </div>
                        `;
                    });
                });
            });
        });
    </script>
</body>
</html>
